<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Portal Siswa - SMAPANMU (Mobile Ready)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Library Face API untuk Deteksi Wajah -->
    <script src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            /* Mencegah scroll berlebih di mobile saat keyboard muncul */
            overscroll-behavior: none;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1.5rem;
        }

        .loader {
            border-top-color: transparent;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(59, 130, 246, 0.5);
            border-radius: 10px;
        }

        /* Style untuk container kamera Responsive */
        #cameraContainer {
            position: relative;
            width: 100%;
            /* Aspect ratio 4:3 untuk mobile */
            aspect-ratio: 3/4; 
            max-height: 400px;
            background: #000;
            border-radius: 1rem;
            overflow: hidden;
            display: none;
            margin: 0 auto;
        }
        
        #videoElement {
            width: 100%;
            height: 100%;
            object-fit: cover; /* Memastikan video memenuhi kotak tanpa gepeng */
            transform: scaleX(-1); /* Mirror effect */
        }

        #canvasElement {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transform: scaleX(-1);
        }

        /* Overlay panduan wajah */
        .scan-guide {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60%;
            height: 50%;
            border: 2px dashed rgba(59, 130, 246, 0.7);
            border-radius: 50%;
            box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.5);
            pointer-events: none;
        }

        @media print {
            body { background: white; }
            .glass-card { border: none; backdrop-filter: none; background: white; }
            .no-print { display: none; }
            .text-white { color: black !important; }
            .text-blue-400 { color: #2563eb !important; }
            .bg-white\/5 { background: #f8fafc !important; border: 1px solid #e2e8f0 !important; }
        }
    </style>
</head>
<body>

    <div id="mainContainer" class="w-full max-w-md transition-all duration-500">
        <!-- Logo & Header -->
        <div id="headerSection" class="text-center mb-8">
            <div class="inline-flex items-center justify-center mb-4 transition-transform hover:scale-105">
                <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi2iWi5Y8Dt91tWD8v24sfYGNL9jWxhRp2epChSaav1QQ3CZWhRb753XFGQOsT9u82kEEQAVkdZVKbbQ2I4Tkhkr9h00KJkaYnZK3jI-HPuUqcO6A3UXFZ9l43qF0sajMqs5asm2ttdvjYUxsxswINcBf7bN7gcNooq-R0KVSFwirkTeTICe6cTnGlyPmQ/s1600/logo%20mapan.png" 
                     alt="Logo SMAPANMU" 
                     class="h-20 w-auto drop-shadow-[0_0_15px_rgba(59,130,246,0.3)]">
            </div>
            <h1 class="text-2xl font-bold text-white tracking-tight">SMAPANMU</h1>
            <p class="text-slate-400 text-sm mt-1">Sistem Data Siswa & Biometrik Mobile</p>
        </div>

        <div class="glass-card shadow-2xl overflow-hidden">
            <!-- TAMPILAN LOGIN -->
            <div id="loginView" class="p-8">
                
                <!-- Status Model AI -->
                <div id="modelStatus" class="text-center mb-4 text-xs text-yellow-400 animate-pulse">
                    <i class="fas fa-cog fa-spin mr-1"></i> Memuat AI (Pastikan Sinyal Bagus)...
                </div>

                <!-- Peringatan HTTPS (Penting untuk HP) -->
                <div id="httpsAlert" class="hidden mb-4 p-3 bg-red-500/20 border border-red-500/50 rounded-lg text-red-200 text-xs text-center">
                    <i class="fas fa-lock mr-1"></i> Akses kamera di HP wajib menggunakan HTTPS (Secure).
                </div>

                <div class="mb-6 text-center">
                    <h2 class="text-xl font-semibold text-white">Login Siswa</h2>
                    <p class="text-sm text-slate-400">Gunakan NISN atau Wajah</p>
                </div>

                <form onsubmit="handleLogin(event)" class="space-y-4">
                    <!-- Input Manual -->
                    <div>
                        <label for="nisn" class="block text-sm font-medium text-slate-300 mb-2">NISN</label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 pl-4 flex items-center text-slate-500">
                                <i class="fas fa-id-card"></i>
                            </span>
                            <input type="text" id="nisn"
                                class="w-full bg-slate-800/50 border border-slate-700 text-white text-lg tracking-widest rounded-xl block pl-11 p-4 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 transition-all placeholder-slate-600"
                                placeholder="NISN Manual"
                                autocomplete="off">
                        </div>
                    </div>

                    <button type="submit" id="submitBtn"
                        class="w-full flex justify-center items-center py-4 px-4 border border-transparent rounded-xl shadow-lg text-sm font-bold text-white bg-blue-600 hover:bg-blue-700 transition-all transform active:scale-95">
                        <i class="fas fa-search mr-2"></i> CEK IDENTITAS
                    </button>
                    
                    <!-- Divider -->
                    <div class="relative flex py-2 items-center">
                        <div class="flex-grow border-t border-slate-700"></div>
                        <span class="flex-shrink-0 mx-4 text-slate-500 text-xs">ATAU GUNAKAN WAJAH</span>
                        <div class="flex-grow border-t border-slate-700"></div>
                    </div>

                    <!-- Tombol Fitur Wajah -->
                    <div class="grid grid-cols-2 gap-3">
                        <button type="button" onclick="openCamera('login')"
                            class="flex flex-col justify-center items-center py-3 px-2 rounded-xl bg-purple-600/20 text-purple-400 border border-purple-500/30 hover:bg-purple-600/30 transition-all active:bg-purple-600/40">
                            <i class="fas fa-expand mb-1 text-xl"></i>
                            <span class="text-xs font-bold">SCAN LOGIN</span>
                        </button>
                        <button type="button" onclick="openCamera('register')"
                            class="flex flex-col justify-center items-center py-3 px-2 rounded-xl bg-emerald-600/20 text-emerald-400 border border-emerald-500/30 hover:bg-emerald-600/30 transition-all active:bg-emerald-600/40">
                            <i class="fas fa-user-plus mb-1 text-xl"></i>
                            <span class="text-xs font-bold">DAFTAR WAJAH</span>
                        </button>
                    </div>

                    <!-- Storage Status Indicator -->
                    <div class="text-center pt-2">
                        <p class="text-[10px] text-slate-500">
                            <i class="fas fa-database mr-1"></i> 
                            <span id="dbStatus">Memeriksa penyimpanan lokal...</span>
                        </p>
                    </div>
                </form>
            </div>

            <!-- TAMPILAN KAMERA -->
            <div id="cameraView" class="hidden p-6 text-center">
                <h3 id="cameraTitle" class="text-lg font-bold text-white mb-2">Pindai Wajah</h3>
                <p id="cameraDesc" class="text-xs text-slate-400 mb-4">Posisikan wajah di dalam lingkaran</p>
                
                <div id="cameraContainer">
                    <!-- Tambahan: playsinline, webkit-playsinline penting untuk iOS -->
                    <video id="videoElement" autoplay muted playsinline webkit-playsinline></video>
                    <canvas id="canvasElement"></canvas>
                    
                    <!-- Guide Visual -->
                    <div class="scan-guide"></div>

                    <!-- Progress Bar for Registration -->
                    <div id="scanProgress" class="absolute bottom-0 left-0 h-1 bg-green-500 transition-all duration-300 w-0 z-20"></div>
                </div>

                <div class="flex gap-2 justify-center mt-4">
                    <button onclick="closeCamera()" class="px-4 py-3 rounded-lg bg-slate-700 text-white hover:bg-slate-600 text-sm w-1/3">
                        Batal
                    </button>
                    <button id="captureBtn" onclick="processFace()" class="px-6 py-3 rounded-lg bg-blue-600 text-white hover:bg-blue-500 font-bold text-sm shadow-lg shadow-blue-500/50 w-2/3">
                        <i class="fas fa-camera mr-2"></i> <span id="btnActionText">Proses</span>
                    </button>
                </div>
            </div>

            <!-- TAMPILAN LOADING -->
            <div id="loadingView" class="hidden p-12 text-center">
                <div class="loader ease-linear rounded-full border-4 border-t-4 border-blue-500 h-12 w-12 mb-6 mx-auto"></div>
                <h3 class="text-lg font-medium text-white">Sinkronisasi Database...</h3>
                <p class="text-slate-400 text-sm italic">Membaca Baris 3 (B:BL) Spreadsheet</p>
            </div>

            <!-- TAMPILAN PROFIL -->
            <div id="profileView" class="hidden flex flex-col h-[85vh] md:h-[600px]">
                <div class="p-6 border-b border-slate-700/50 bg-blue-600/10 flex justify-between items-center no-print">
                    <div>
                        <h3 class="text-white font-bold text-lg">Detail Data</h3>
                        <p id="studentSummary" class="text-blue-400 text-[10px] uppercase tracking-widest font-bold"></p>
                    </div>
                    <button onclick="logout()" class="text-slate-400 hover:text-white transition-colors text-sm bg-slate-800 px-3 py-2 rounded-lg border border-slate-700">
                        <i class="fas fa-sign-out-alt mr-1"></i>
                    </button>
                </div>
                
                <div id="dataGrid" class="flex-1 overflow-y-auto p-6 custom-scrollbar grid grid-cols-1 md:grid-cols-2 gap-3">
                    <!-- Data otomatis dirender di sini -->
                </div>
                
                <div class="p-4 bg-slate-900/50 border-t border-slate-700/50 no-print space-y-2">
                    <div class="grid grid-cols-2 gap-2">
                        <a href="https://myshatakuthujan-sketch.github.io/presensi/" 
                           target="_blank"
                           class="flex items-center justify-center py-3 rounded-lg bg-green-600/20 text-green-400 text-xs font-bold hover:bg-green-600/30 transition-all border border-green-500/30 uppercase tracking-widest">
                            <i class="fas fa-calendar-check mr-2"></i> Presensi
                        </a>
                        <a href="https://docs.google.com/forms/d/e/1FAIpQLSf68VjAnQifkmafkLlkxVNCnCK71TcBABtzTeOLuEpLVJP5jQ/viewform?usp=dialog" 
                           target="_blank"
                           class="flex items-center justify-center py-3 rounded-lg bg-amber-600/20 text-amber-400 text-xs font-bold hover:bg-amber-600/30 transition-all border border-amber-500/30 uppercase tracking-widest">
                            <i class="fas fa-edit mr-2"></i> Perbaikan
                        </a>
                    </div>
                    <button onclick="window.print()" class="w-full py-3 rounded-lg bg-blue-600/20 text-blue-400 text-xs font-bold hover:bg-blue-600/30 transition-all border border-blue-500/30 uppercase tracking-widest">
                        <i class="fas fa-print mr-2"></i> Unduh / Cetak
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Alert -->
    <div id="alertBox" class="fixed bottom-5 left-1/2 -translate-x-1/2 max-w-sm w-[90%] bg-red-600 text-white p-4 rounded-xl shadow-2xl opacity-0 transition-all duration-300 pointer-events-none flex items-center space-x-3 z-50">
        <i class="fas fa-exclamation-circle text-xl"></i>
        <div id="alertText">NISN tidak terdaftar!</div>
    </div>

    <script>
        const SPREADSHEET_ID = '1YbCtOBnFaz8i56sfMmiFaouXUrDyNixHt951WyLNK0U';
        const GID = '729829202';
        const SHEET_URL = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/export?format=csv&gid=${GID}`;

        // === FACE API CONFIG & VARIABLES ===
        let isModelLoaded = false;
        let currentMode = ''; 
        let stream = null;
        let detectionInterval = null;

        // Fungsi Update Status DB
        function updateDbStatus() {
            const db = JSON.parse(localStorage.getItem('face_db_v2') || '[]');
            const statusEl = document.getElementById('dbStatus');
            if (statusEl) {
                statusEl.innerText = `${db.length} Wajah Tersimpan`;
            }
        }

        // Inisialisasi Model
        window.addEventListener('load', async () => {
            updateDbStatus();
            
            // Cek HTTPS untuk HP
            if (location.protocol !== 'https:' && location.hostname !== 'localhost' && location.hostname !== '127.0.0.1') {
                document.getElementById('httpsAlert').classList.remove('hidden');
            }

            try {
                const MODEL_URL = 'https://justadudewhohacks.github.io/face-api.js/models';
                await Promise.all([
                    faceapi.nets.ssdMobilenetv1.loadFromUri(MODEL_URL), 
                    faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL),
                    faceapi.nets.faceRecognitionNet.loadFromUri(MODEL_URL)
                ]);
                
                isModelLoaded = true;
                const statusEl = document.getElementById('modelStatus');
                statusEl.innerHTML = '<i class="fas fa-check-circle text-green-400"></i> Sistem Wajah Siap';
                statusEl.classList.remove('animate-pulse', 'text-yellow-400');
                statusEl.classList.add('text-green-400');
                setTimeout(() => { statusEl.style.display = 'none'; }, 2000);
            } catch (err) {
                console.error(err);
                showAlert("Gagal memuat sistem wajah (Cek Koneksi/Refresh)");
            }
        });

        function showAlert(message) {
            const alertBox = document.getElementById('alertBox');
            const alertText = document.getElementById('alertText');
            alertText.innerText = message;
            alertBox.classList.replace('opacity-0', 'opacity-100');
            setTimeout(() => {
                alertBox.classList.replace('opacity-100', 'opacity-0');
            }, 3000);
        }

        function logout() { window.location.reload(); }

        // --- CSV PARSER ---
        function parseCSV(text) {
            const rows = [];
            let row = [];
            let col = "";
            let inQuotes = false;

            for (let i = 0; i < text.length; i++) {
                let char = text[i];
                let next = text[i+1];

                if (char === '"' && inQuotes && next === '"') {
                    col += '"'; i++; 
                } else if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    row.push(col.trim());
                    col = "";
                } else if ((char === '\r' || char === '\n') && !inQuotes) {
                    row.push(col.trim());
                    if (row.length > 0) rows.push(row);
                    row = [];
                    col = "";
                    if (char === '\r' && next === '\n') i++;
                } else {
                    col += char;
                }
            }
            if (col || row.length > 0) {
                row.push(col.trim());
                rows.push(row);
            }
            return rows;
        }

        // --- LOGIC LOGIN UTAMA ---
        async function handleLogin(event, providedNisn = null) {
            if(event) event.preventDefault();
            
            const inputNisn = providedNisn || document.getElementById('nisn').value.trim();
            const loginView = document.getElementById('loginView');
            const loadingView = document.getElementById('loadingView');
            const profileView = document.getElementById('profileView');
            const dataGrid = document.getElementById('dataGrid');
            const mainContainer = document.getElementById('mainContainer');

            if (!inputNisn) return showAlert("Masukkan NISN!");

            loginView.classList.add('hidden');
            loadingView.classList.remove('hidden');

            try {
                const response = await fetch(SHEET_URL);
                if (!response.ok) throw new Error("Koneksi database gagal.");
                
                const csvContent = await response.text();
                const rows = parseCSV(csvContent);
                const headers = rows[2]; 

                let studentRow = null;
                for (let i = 3; i < rows.length; i++) {
                    if (rows[i] && rows[i][1] === inputNisn) {
                        studentRow = rows[i];
                        break;
                    }
                }

                if (studentRow) {
                    dataGrid.innerHTML = '';
                    const startIdx = 1;
                    const endIdx = 63; 

                    for (let j = startIdx; j <= endIdx; j++) {
                        const labelName = (headers[j] && headers[j] !== "") ? headers[j] : `Data ${j}`;
                        const valueData = (studentRow[j] && studentRow[j] !== "") ? studentRow[j] : "-";
                        const card = document.createElement('div');
                        card.className = "bg-white/5 p-4 rounded-xl border border-white/5 hover:border-blue-500/30 transition-all group";
                        card.innerHTML = `
                            <div class="text-[9px] text-blue-400 font-black uppercase tracking-widest mb-1 group-hover:text-blue-300 transition-colors">${labelName}</div>
                            <div class="text-white text-sm font-medium break-words">${valueData}</div>
                        `;
                        dataGrid.appendChild(card);
                    }
                    document.getElementById('studentSummary').innerText = `ID: ${inputNisn} â€¢ STATUS: TERVERIFIKASI`;
                    mainContainer.classList.replace('max-w-md', 'max-w-4xl');
                    loadingView.classList.add('hidden');
                    profileView.classList.remove('hidden');
                } else {
                    throw new Error("NISN '" + inputNisn + "' tidak ditemukan.");
                }
            } catch (error) {
                loadingView.classList.add('hidden');
                loginView.classList.remove('hidden');
                showAlert(error.message);
            }
        }

        // --- FITUR WAJAH MOBILE & DESKTOP ---

        async function openCamera(mode) {
            if (!isModelLoaded) return showAlert("Tunggu model AI dimuat (Cek koneksi).");
            
            if (mode === 'register') {
                const nisn = document.getElementById('nisn').value.trim();
                if (!nisn) return showAlert("Isi NISN dulu untuk mendaftar!");
            }

            // Cek dukungan browser
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                return showAlert("Browser ini tidak mendukung akses kamera (Coba Chrome/Safari)");
            }

            currentMode = mode;
            document.getElementById('loginView').classList.add('hidden');
            document.getElementById('cameraView').classList.remove('hidden');
            document.getElementById('scanProgress').style.width = '0%';
            
            document.getElementById('cameraTitle').innerText = mode === 'login' ? "Scan Login (Akurat)" : "Registrasi Wajah (3 Tahap)";
            
            const btnText = mode === 'login' ? "Login" : "Mulai Scan";
            document.getElementById('captureBtn').innerHTML = `<i class="fas fa-camera mr-2"></i> <span id="btnActionText">${btnText}</span>`;

            try {
                // Constraints khusus Mobile: Preferensi kamera depan, resolusi ideal
                const constraints = {
                    audio: false,
                    video: {
                        facingMode: 'user', // "user" = kamera depan, "environment" = kamera belakang
                        width: { ideal: 640 },
                        height: { ideal: 480 }
                    }
                };

                stream = await navigator.mediaDevices.getUserMedia(constraints);
                const videoEl = document.getElementById('videoElement');
                videoEl.srcObject = stream;
                document.getElementById('cameraContainer').style.display = 'block';
            } catch (err) {
                console.error(err);
                if(err.name === 'NotAllowedError') {
                    showAlert("Akses kamera ditolak! Izinkan di pengaturan browser.");
                } else if (err.name === 'NotFoundError') {
                    showAlert("Kamera tidak ditemukan.");
                } else {
                    showAlert("Gagal membuka kamera: " + err.message);
                }
                closeCamera();
            }
        }

        function closeCamera() {
            if (stream) stream.getTracks().forEach(track => track.stop());
            document.getElementById('cameraView').classList.add('hidden');
            document.getElementById('loginView').classList.remove('hidden');
            document.getElementById('cameraContainer').style.display = 'none';
        }

        function getFaceDetectorOptions() {
            // Gunakan threshold 0.5 agar seimbang antara akurasi dan kecepatan di HP
            return new faceapi.SsdMobilenetv1Options({ minConfidence: 0.5 });
        }

        async function processFace() {
            const videoEl = document.getElementById('videoElement');
            const captureBtn = document.getElementById('captureBtn');
            const progressEl = document.getElementById('scanProgress');

            if (currentMode === 'register') {
                // === MODE REGISTRASI ===
                const nisn = document.getElementById('nisn').value.trim();
                captureBtn.disabled = true;
                
                let descriptors = [];
                const totalSamples = 3; 

                try {
                    for (let i = 1; i <= totalSamples; i++) {
                        captureBtn.innerHTML = `<i class="fas fa-camera"></i> Ambil ${i}/${totalSamples}...`;
                        
                        const detection = await faceapi.detectSingleFace(videoEl, getFaceDetectorOptions())
                            .withFaceLandmarks()
                            .withFaceDescriptor();

                        if (!detection) {
                            throw new Error("Wajah tidak jelas! Posisikan wajah di lingkaran.");
                        }
                        
                        // Validasi skor
                        if (detection.detection.score < 0.75) {
                            throw new Error("Kualitas kurang bagus. Cari tempat terang.");
                        }

                        descriptors.push(Array.from(detection.descriptor));
                        progressEl.style.width = `${(i / totalSamples) * 100}%`;
                        
                        // Delay sedikit
                        await new Promise(r => setTimeout(r, 800)); 
                    }

                    const userData = {
                        nisn: nisn,
                        descriptors: descriptors,
                        timestamp: new Date().toISOString()
                    };

                    let db = JSON.parse(localStorage.getItem('face_db_v2') || '[]');
                    db = db.filter(u => u.nisn !== nisn);
                    db.push(userData);
                    localStorage.setItem('face_db_v2', JSON.stringify(db));
                    updateDbStatus();

                    showAlert("Registrasi Sukses! Data tersimpan di HP ini.");
                    closeCamera();

                } catch (err) {
                    showAlert(err.message);
                    progressEl.style.width = '0%';
                } finally {
                    captureBtn.disabled = false;
                    captureBtn.innerHTML = `<i class="fas fa-camera mr-2"></i> <span id="btnActionText">Mulai Scan</span>`;
                }

            } else {
                // === MODE LOGIN ===
                captureBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Mencari...';
                captureBtn.disabled = true;

                try {
                    const db = JSON.parse(localStorage.getItem('face_db_v2') || '[]');
                    if (db.length === 0) throw new Error("Belum ada data wajah di HP ini.");

                    const detection = await faceapi.detectSingleFace(videoEl, getFaceDetectorOptions())
                        .withFaceLandmarks()
                        .withFaceDescriptor();

                    if (!detection) throw new Error("Wajah tidak terdeteksi. Posisikan di tengah.");

                    const labeledDescriptors = db.map(user => {
                        let descArray;
                        if (user.descriptors) {
                            descArray = user.descriptors.map(d => new Float32Array(d));
                        } else if (user.descriptor) {
                            descArray = [new Float32Array(user.descriptor)];
                        }
                        return new faceapi.LabeledFaceDescriptors(user.nisn, descArray);
                    });

                    // Threshold 0.45 = Ketat/Akurat
                    const faceMatcher = new faceapi.FaceMatcher(labeledDescriptors, 0.45);
                    const result = faceMatcher.findBestMatch(detection.descriptor);

                    if (result.label !== 'unknown') {
                        const confidencePercent = Math.round((1 - result.distance) * 100);
                        showAlert(`Login Berhasil: ${result.label} (${confidencePercent}%)`);
                        closeCamera();
                        handleLogin(null, result.label);
                    } else {
                        throw new Error("Wajah tidak dikenali. Silakan daftar dulu.");
                    }

                } catch (err) {
                    showAlert(err.message);
                } finally {
                    captureBtn.disabled = false;
                    captureBtn.innerHTML = `<i class="fas fa-camera mr-2"></i> <span id="btnActionText">Login</span>`;
                }
            }
        }
    </script>
</body>
</html>
