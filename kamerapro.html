<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ProCam Ultra - Cinema Suite v19</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-color: #000;
            color: #fff;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            overflow: hidden;
            height: 100vh;
            margin: 0;
            padding: 0;
            user-select: none;
        }

        .camera-container {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            background: #000;
        }

        .camera-preview {
            flex: 1;
            position: relative;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            background: #111;
        }

        #video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.2s ease-out;
            transform-origin: center center;
        }

        /* Overlays for Special Effects */
        .effect-overlay {
            position: absolute;
            inset: 0;
            pointer-events: none;
            z-index: 10;
            opacity: 0;
            transition: opacity 0.3s;
        }

        /* Light Leak Effect */
        .light-leak {
            background: linear-gradient(135deg, rgba(255,0,0,0.2) 0%, rgba(255,165,0,0.1) 50%, transparent 100%);
            mix-blend-mode: screen;
        }

        /* Lens Flare Simulation */
        .lens-flare {
            background: radial-gradient(circle at 20% 20%, rgba(255,255,255,0.4) 0%, transparent 10%, rgba(255,200,0,0.1) 20%, transparent 50%);
            mix-blend-mode: screen;
        }

        /* UI Trays */
        .ui-tray {
            position: absolute; left: 0; width: 100%; z-index: 50;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .filter-tray { 
            top: 100px; 
            display: flex; 
            gap: 12px; 
            overflow-x: auto; 
            padding: 15px 20px; 
            background: rgba(0,0,0,0.85);
            backdrop-filter: blur(25px);
            scrollbar-width: none;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .filter-tray::-webkit-scrollbar { display: none; }

        .zoom-overlay, .speed-overlay { 
            bottom: 160px;
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            padding-bottom: 15px;
        }

        .speed-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            padding: 12px;
            background: rgba(0,0,0,0.85);
            border-radius: 24px;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255,255,255,0.15);
        }

        /* --- EXTENDED FILTER LIBRARY --- */
        .filter-none { filter: none; }
        
        /* 1. Cinematic & Tone Populer */
        .filter-teal-orange { filter: contrast(1.25) saturate(1.4) hue-rotate(-15deg) brightness(0.9); }
        .filter-warm-nostalgia { filter: sepia(0.45) saturate(1.3) brightness(1.05) contrast(0.95); }
        .filter-cool-desat { filter: hue-rotate(185deg) saturate(0.4) brightness(1.1) contrast(1.1); }
        .filter-dark-moody { filter: brightness(0.65) contrast(1.5) saturate(0.7) sepia(0.1); }
        
        /* 2. VSCO & Professional Looks */
        .filter-vsco-m5 { filter: sepia(0.2) contrast(1.1) brightness(0.95) saturate(0.8); }
        .filter-vsco-c1 { filter: saturate(1.6) contrast(1.1) brightness(1.05); }
        .filter-vsco-f2 { filter: contrast(0.85) brightness(1.1) saturate(0.9) sepia(0.15) opacity(0.9); }
        .filter-lightroom-film { filter: contrast(1.15) saturate(1.2) sepia(0.1) brightness(1.02); }
        
        /* 3. Vintage, VHS & DazzCam */
        .filter-vhs-classic { filter: contrast(0.8) saturate(1.5) sepia(0.25) blur(0.4px); }
        .filter-grainy-film { filter: contrast(1.1) brightness(1.1) url(#noise); }
        .filter-dazz-cpm35 { filter: contrast(1.2) saturate(1.3) sepia(0.2) brightness(0.9); }
        
        /* 4. Trendy & TikTok Styles */
        .filter-tiktok-blue-hiphop { filter: hue-rotate(190deg) contrast(1.3) saturate(1.5) brightness(0.9); }
        .filter-dreamy-bokeh { filter: brightness(1.1) blur(1.2px) saturate(1.3) contrast(0.85); }
        .filter-soft-pastel { filter: brightness(1.25) saturate(0.7) contrast(0.8) hue-rotate(-5deg); }
        .filter-aesthetic-brown { filter: sepia(0.7) contrast(0.9) brightness(1.05) saturate(0.6); }
        
        /* 5. Classic & Minimalist */
        .filter-bw-high-contrast { filter: grayscale(1) contrast(1.8) brightness(0.9); }
        .filter-minimalist { filter: contrast(1.05) brightness(1.05) saturate(0.85); }

        .magic-auto-active { filter: brightness(1.15) contrast(1.1) saturate(1.2) !important; }

        /* UI Elements */
        .active-btn { background-color: #ffcc00 !important; color: black !important; border-color: #ffcc00 !important; }
        
        .filter-card { flex: 0 0 auto; width: 75px; display: flex; flex-direction: column; align-items: center; gap: 6px; cursor: pointer; }
        .filter-thumb { width: 55px; height: 55px; border-radius: 16px; border: 2px solid rgba(255,255,255,0.2); background: #222; transition: all 0.2s; position: relative; }
        .active .filter-thumb { border-color: #ffcc00; transform: scale(1.1); box-shadow: 0 0 20px rgba(255,204,0,0.4); }
        .filter-name { font-size: 7px; font-weight: 800; text-transform: uppercase; color: rgba(255,255,255,0.5); text-align: center; letter-spacing: 0.5px; height: 20px; }
        .active .filter-name { color: #ffcc00; }

        .hidden-tray { transform: translateY(-20px); opacity: 0; pointer-events: none; }
        .speed-overlay.hidden-tray, .zoom-overlay.hidden-tray { transform: translateY(20px); }

        .shutter-photo { width: 75px; height: 75px; background: #fff; border-radius: 50%; border: 6px solid rgba(255, 255, 255, 0.3); transition: transform 0.1s; }
        #recording-dot { width: 20px; height: 20px; background: #ff0000; border-radius: 50%; transition: all 0.3s; }
        .recording-active #recording-dot { border-radius: 4px; transform: scale(0.85); }

        #save-toast {
            position: fixed; top: 12%; left: 50%; transform: translateX(-50%) translateY(-100px);
            background: #fff; color: #000; padding: 10px 25px; border-radius: 50px;
            font-size: 12px; font-weight: bold; z-index: 1000; transition: transform 0.5s;
        }
        #save-toast.show { transform: translateX(-50%) translateY(0); }
    </style>
</head>
<body>

    <!-- SVG Filter for Film Grain -->
    <svg style="display:none;">
        <filter id="noise">
            <feTurbulence type="fractalNoise" baseFrequency="0.75" numOctaves="3" stitchTiles="stitch" />
            <feComponentTransfer><feFuncR type="linear" slope="0.12" /><feFuncG type="linear" slope="0.12" /><feFuncB type="linear" slope="0.12" /></feComponentTransfer>
            <feComposite operator="in" in2="SourceGraphic" />
            <feBlend mode="overlay" in2="SourceGraphic" />
        </filter>
    </svg>

    <div id="save-toast">Pesan Disimpan</div>

    <div class="camera-container">
        <!-- Header Controls -->
        <div class="absolute top-0 left-0 w-full pt-12 pb-4 px-4 flex justify-between items-center z-[60] bg-gradient-to-b from-black/90 to-transparent">
            <div class="flex items-center gap-2">
                <div id="recording-indicator" class="hidden flex items-center bg-red-600/90 px-3 py-1 rounded-full text-[10px] font-bold">
                    <span class="w-2 h-2 rounded-full bg-white animate-ping mr-2"></span>
                    <span id="timer">00:00</span>
                </div>
                <button onclick="toggleMagicAuto()" id="btn-magic" class="bg-black/50 px-3 py-2 rounded-full border border-white/20 text-[9px] font-bold uppercase tracking-widest">Magic</button>
                <button onclick="toggleMirror()" id="btn-mirror" class="bg-black/50 px-3 py-2 rounded-full border border-white/20 text-[9px] font-bold uppercase tracking-widest">Mirror</button>
            </div>
            
            <div class="flex gap-2">
                <button onclick="cycleFlash()" id="btn-flash" class="bg-black/50 p-2.5 rounded-full border border-white/20 text-[9px] font-bold uppercase">ðŸ”¦ Off</button>
                <button onclick="toggleTray('speed')" id="btn-speed-toggle" class="bg-black/50 p-2.5 rounded-full border border-white/20 text-[10px] font-bold min-w-[42px]">1x</button>
                <button onclick="toggleTray('zoom')" id="btn-zoom-toggle" class="bg-black/50 p-2.5 rounded-full border border-white/20 text-[10px] font-bold min-w-[42px]">1.0x</button>
                <button onclick="toggleTray('filter')" class="bg-black/50 p-2.5 rounded-full border border-white/20"><svg width="18" height="18" fill="white" viewBox="0 0 24 24"><path d="M14.73 20.83L17.58 18L14.73 15.17L15.85 14.03L20 18.17L15.85 22.31L14.73 20.83M10.5 12.78L12.75 15L8.5 19.25L4.25 15L6.5 12.78L10.5 12.78M10.5 3L15 7.5L10.5 12L6 7.5L10.5 3Z"/></svg></button>
                <button onclick="switchCamera()" class="bg-black/50 p-2.5 rounded-full border border-white/20"><svg width="18" height="18" fill="white" viewBox="0 0 24 24"><path d="M19 8l-4 4h3c0 3.31-2.69 6-6 6-1.01 0-1.97-.25-2.8-.7l-1.46 1.46C8.97 19.54 10.43 20 12 20c4.42 0 8-3.58 8-8h3l-4-4zM6 12c0-3.31 2.69-6 6-6 1.01 0-1.97.25 2.8.7l1.46-1.46C15.03 4.46 13.57 4 12 4c-4.42 0-8 3.58-8 8H1l4 4 4-4H6z"/></svg></button>
            </div>
        </div>

        <div class="camera-preview">
            <video id="video" autoplay playsinline muted></video>
            
            <!-- Effect Overlays -->
            <div id="leak-overlay" class="effect-overlay light-leak"></div>
            <div id="flare-overlay" class="effect-overlay lens-flare"></div>

            <div id="grid-lines" class="absolute inset-0 pointer-events-none hidden">
                <div class="absolute w-full h-[0.5px] bg-white/40 top-1/3"></div>
                <div class="absolute w-full h-[0.5px] bg-white/40 top-2/3"></div>
                <div class="absolute h-full w-[0.5px] bg-white/40 left-1/3"></div>
                <div class="absolute h-full w-[0.5px] bg-white/40 left-2/3"></div>
            </div>
        </div>

        <!-- Trays -->
        <div id="filter-tray" class="ui-tray filter-tray hidden-tray"></div>

        <div id="zoom-tray" class="ui-tray zoom-overlay hidden-tray">
            <input type="range" id="zoom-slider" min="1" max="16" step="0.1" value="1" class="w-2/3 accent-yellow-400" oninput="updateZoom(this.value)">
            <span class="text-[11px] font-extrabold text-yellow-400 mt-2 bg-black/60 px-3 py-1 rounded-full" id="zoom-text">1.0x</span>
        </div>

        <div id="speed-tray" class="ui-tray speed-overlay hidden-tray">
            <div class="speed-grid">
                <button onclick="setVideoSpeed(0.5)" id="speed-0.5" class="px-3 py-2 rounded-xl bg-white/5 border border-white/10 text-[9px] font-bold">0.5x</button>
                <button onclick="setVideoSpeed(1)" id="speed-1" class="px-3 py-2 rounded-xl bg-white/5 border border-white/10 text-[9px] font-bold active-btn">1x</button>
                <button onclick="setVideoSpeed(2)" id="speed-2" class="px-3 py-2 rounded-xl bg-white/5 border border-white/10 text-[9px] font-bold">2x</button>
                <button onclick="setVideoSpeed(4)" id="speed-4" class="px-3 py-2 rounded-xl bg-white/5 border border-white/10 text-[9px] font-bold">4x</button>
                <button onclick="setVideoSpeed(8)" id="speed-8" class="px-3 py-2 rounded-xl bg-white/5 border border-white/10 text-[9px] font-bold">8x</button>
                <button onclick="setVideoSpeed(16)" id="speed-16" class="px-3 py-2 rounded-xl bg-white/5 border border-white/10 text-[9px] font-bold">16x</button>
            </div>
        </div>

        <!-- Bottom Controls -->
        <div class="w-full px-10 pt-4 pb-16 flex justify-between items-center bg-black">
            <div id="gallery-preview" class="w-12 h-12 rounded-lg border-2 border-white/30 bg-cover bg-center overflow-hidden" onclick="showToast('Lihat hasil di Galeri HP')">
                <div class="w-full h-full bg-white/5 flex items-center justify-center opacity-40 text-[8px] font-bold text-center uppercase">Media</div>
            </div>
            
            <button onclick="handleCapture()" class="shutter-photo active:scale-95 transition-transform"></button>
            
            <button onclick="toggleRecording()" id="video-trigger" class="w-16 h-16 rounded-full border-2 border-white/40 flex items-center justify-center">
                <div id="recording-dot"></div>
            </button>
        </div>
    </div>

    <script>
        const video = document.getElementById('video');
        const leakOverlay = document.getElementById('leak-overlay');
        const flareOverlay = document.getElementById('flare-overlay');
        const galleryPreview = document.getElementById('gallery-preview');
        
        let isFrontCamera = false;
        let activeFilter = 'none';
        let currentZoom = 1;
        let currentSpeed = 1;
        let isMagicAuto = false;
        let isMirror = false;
        let isRecording = false;
        let recordStartTime = 0;
        let timerInterval = null;
        let mediaRecorder;
        let recordedChunks = [];
        let currentStream = null;
        let flashOn = false;

        const FILTERS = [
            { id: 'none', name: 'Asli' },
            { id: 'teal-orange', name: 'Teal & Orange' }, 
            { id: 'warm-nostalgia', name: 'Warm Nostalgia' }, 
            { id: 'cool-desat', name: 'Cool & Cold' },
            { id: 'dark-moody', name: 'Dark Moody' },
            { id: 'vsco-m5', name: 'VSCO M5' },
            { id: 'vsco-c1', name: 'VSCO C1' },
            { id: 'vsco-f2', name: 'VSCO F2 Matte' },
            { id: 'lightroom-film', name: 'LR Pro Film' },
            { id: 'vhs-classic', name: 'Vintage VHS' }, 
            { id: 'grainy-film', name: 'Film Grain' },
            { id: 'dazz-cpm35', name: 'Dazz CPM35' },
            { id: 'tiktok-blue-hiphop', name: 'TikTok Blue' },
            { id: 'dreamy-bokeh', name: 'Dreamy Bokeh' },
            { id: 'soft-pastel', name: 'Soft Pastel' },
            { id: 'aesthetic-brown', name: 'Warm Brown' },
            { id: 'bw-high-contrast', name: 'B&W Drama' },
            { id: 'minimalist', name: 'Minimalist' }
        ];

        async function initCamera() {
            if (currentStream) currentStream.getTracks().forEach(t => t.stop());
            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: { 
                        facingMode: isFrontCamera ? 'user' : 'environment',
                        width: { ideal: 1920 },
                        height: { ideal: 1080 }
                    },
                    audio: true
                });
                currentStream = stream;
                video.srcObject = stream;
                updateFilters();
            } catch (e) {
                showToast("Izin Kamera Diperlukan");
            }
        }

        async function cycleFlash() {
            if (!currentStream || isFrontCamera) {
                showToast("Gunakan Kamera Belakang");
                return;
            }
            const track = currentStream.getVideoTracks()[0];
            const capabilities = track.getCapabilities();
            if (capabilities.torch) {
                flashOn = !flashOn;
                await track.applyConstraints({ advanced: [{ torch: flashOn }] });
                document.getElementById('btn-flash').innerText = flashOn ? 'ðŸ”¦ On' : 'ðŸ”¦ Off';
                document.getElementById('btn-flash').classList.toggle('active-btn', flashOn);
            } else {
                showToast("Flash Tidak Didukung");
            }
        }

        function toggleMagicAuto() {
            isMagicAuto = !isMagicAuto;
            document.getElementById('btn-magic').classList.toggle('active-btn', isMagicAuto);
            updateFilters();
        }

        function toggleMirror() {
            isMirror = !isMirror;
            document.getElementById('btn-mirror').classList.toggle('active-btn', isMirror);
            updateFilters();
        }

        function setVideoSpeed(speed) {
            currentSpeed = speed;
            document.getElementById('btn-speed-toggle').innerText = speed + 'x';
            document.querySelectorAll('.speed-grid button').forEach(b => b.classList.remove('active-btn'));
            document.getElementById('speed-' + speed).classList.add('active-btn');
            showToast(`Speed: ${speed}x`);
        }

        function updateZoom(val) {
            currentZoom = val;
            document.getElementById('zoom-text').innerText = parseFloat(val).toFixed(1) + 'x';
            document.getElementById('btn-zoom-toggle').innerText = parseFloat(val).toFixed(1) + 'x';
            updateFilters();
        }

        function updateFilters() {
            video.className = `filter-${activeFilter} ${isMagicAuto ? 'magic-auto-active' : ''}`;
            
            // Toggle Overlays based on filter type
            leakOverlay.style.opacity = (activeFilter === 'vhs-classic' || activeFilter === 'dazz-cpm35') ? '1' : '0';
            flareOverlay.style.opacity = (activeFilter === 'warm-nostalgia' || activeFilter === 'dreamy-bokeh') ? '1' : '0';

            let scaleX = (isFrontCamera) ? -1 : 1;
            if (isMirror) scaleX *= -1;
            video.style.transform = `scale(${currentZoom}) scaleX(${scaleX})`;
        }

        function setFilter(id) {
            activeFilter = id;
            updateFilters();
            renderFilters();
        }

        function toggleTray(type) {
            const trays = ['filter', 'zoom', 'speed'];
            trays.forEach(t => {
                const el = document.getElementById(`${t}-tray`);
                if(t === type) el.classList.toggle('hidden-tray');
                else el.classList.add('hidden-tray');
            });
        }

        function renderFilters() {
            const tray = document.getElementById('filter-tray');
            tray.innerHTML = '';
            FILTERS.forEach(f => {
                const card = document.createElement('div');
                card.className = `filter-card ${f.id === activeFilter ? 'active' : ''}`;
                card.onclick = () => setFilter(f.id);
                card.innerHTML = `<div class="filter-thumb filter-${f.id}"></div><span class="filter-name">${f.name}</span>`;
                tray.appendChild(card);
            });
        }

        function handleCapture() {
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth; 
            canvas.height = video.videoHeight;
            const c = canvas.getContext('2d');
            
            let scaleX = (isFrontCamera) ? -1 : 1;
            if (isMirror) scaleX *= -1;
            if(scaleX === -1) { c.translate(canvas.width, 0); c.scale(-1, 1); }
            
            c.filter = getComputedStyle(video).filter;
            const zoomW = canvas.width / currentZoom;
            const zoomH = canvas.height / currentZoom;
            const zoomX = (canvas.width - zoomW) / 2;
            const zoomY = (canvas.height - zoomH) / 2;

            c.drawImage(video, zoomX, zoomY, zoomW, zoomH, 0, 0, canvas.width, canvas.height);
            
            // Capture Light Leak/Flare if active
            if (parseFloat(getComputedStyle(leakOverlay).opacity) > 0) {
                c.fillStyle = 'rgba(255,100,0,0.1)';
                c.fillRect(0,0,canvas.width, canvas.height);
            }

            const dataUrl = canvas.toDataURL('image/jpeg', 0.98);
            galleryPreview.style.backgroundImage = `url(${dataUrl})`;
            
            const a = document.createElement('a');
            a.href = dataUrl;
            a.download = `PRO_IMG_${Date.now()}.jpg`;
            a.click();
            showToast("Foto Disimpan ke Galeri");
        }

        function toggleRecording() {
            if (!isRecording) startRecording();
            else stopRecording();
        }

        function startRecording() {
            recordedChunks = [];
            const types = ['video/mp4', 'video/webm;codecs=vp9', 'video/webm'];
            const mimeType = types.find(t => MediaRecorder.isTypeSupported(t)) || '';
            
            try {
                mediaRecorder = new MediaRecorder(currentStream, { mimeType, videoBitsPerSecond: 10000000 });
                mediaRecorder.ondataavailable = (e) => { if (e.data.size > 0) recordedChunks.push(e.data); };
                mediaRecorder.onstop = saveVideo;
                mediaRecorder.start();
                
                isRecording = true;
                document.getElementById('video-trigger').classList.add('recording-active');
                document.getElementById('recording-indicator').classList.remove('hidden');
                recordStartTime = Date.now();
                timerInterval = setInterval(updateTimer, 1000);
            } catch (e) {
                showToast("Rekam Gagal");
            }
        }

        function stopRecording() {
            if(mediaRecorder && isRecording) {
                mediaRecorder.stop();
                isRecording = false;
                document.getElementById('video-trigger').classList.remove('recording-active');
                document.getElementById('recording-indicator').classList.add('hidden');
                clearInterval(timerInterval);
            }
        }

        function saveVideo() {
            const blob = new Blob(recordedChunks, { type: mediaRecorder.mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            const ext = mediaRecorder.mimeType.includes('mp4') ? 'mp4' : 'webm';
            a.href = url;
            a.download = `PRO_VID_${Date.now()}_${currentSpeed}x.${ext}`;
            document.body.appendChild(a);
            a.click();
            setTimeout(() => { document.body.removeChild(a); window.URL.revokeObjectURL(url); }, 500);
            showToast("Video Disimpan ke Galeri");
        }

        function updateTimer() {
            const diff = Math.floor((Date.now() - recordStartTime) / 1000);
            const m = String(Math.floor(diff / 60)).padStart(2, '0');
            const s = String(diff % 60).padStart(2, '0');
            document.getElementById('timer').innerText = `${m}:${s}`;
        }

        function showToast(msg) {
            const toast = document.getElementById('save-toast');
            toast.innerText = msg;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2000);
        }
        
        function switchCamera() { 
            isFrontCamera = !isFrontCamera; 
            initCamera(); 
        }

        window.onload = () => { initCamera(); renderFilters(); };
    </script>
</body>
</html>
