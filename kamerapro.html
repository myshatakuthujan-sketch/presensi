<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ProCam Ultra - Cinema Suite v9</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-color: #000;
            color: #fff;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            overflow: hidden;
            height: 100vh;
            user-select: none;
        }

        .camera-preview {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            background: #000;
            touch-action: none; /* Penting untuk menangani swipe secara manual */
        }

        video, #editor-canvas {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.4s cubic-bezier(0.2, 1, 0.2, 1), filter 0.5s ease;
            transform-origin: center center;
        }

        /* --- GRID LINES --- */
        .grid-overlay {
            position: absolute;
            inset: 0;
            pointer-events: none;
            display: none;
            z-index: 5;
        }
        .grid-overlay.active { display: block; }
        .grid-line-h { position: absolute; width: 100%; height: 1px; background: rgba(255,255,255,0.3); left: 0; }
        .grid-line-v { position: absolute; height: 100%; width: 1px; background: rgba(255,255,255,0.3); top: 0; }

        /* --- FILTER DEFINITIONS --- */
        .filter-none { filter: none; }
        .filter-bw { filter: grayscale(1) contrast(1.4) brightness(0.9); }
        .filter-noir { filter: grayscale(1) sepia(0.1) contrast(1.8) brightness(0.8); }
        .filter-cpm35 { filter: sepia(0.3) contrast(1.1) saturate(1.4) hue-rotate(-5deg) brightness(0.95); }
        .filter-classic { filter: contrast(1.1) saturate(0.8) sepia(0.4) brightness(1.05); }
        .filter-vhs { filter: contrast(0.9) saturate(1.2) hue-rotate(10deg) blur(0.3px); }
        .filter-pastel { filter: saturate(1.5) brightness(1.1) contrast(0.8) sepia(0.1); }
        .filter-brown { filter: sepia(0.5) contrast(1.1) brightness(0.9) saturate(0.9); }
        .filter-minimalist { filter: contrast(1.05) brightness(1.05) saturate(0.9); }
        .filter-bokeh { filter: contrast(1.1) brightness(1.05); }
        .filter-painting { filter: contrast(1.3) saturate(1.6) posterize(5) brightness(1.1); }
        .filter-lightlens { filter: brightness(1.2) saturate(1.1) sepia(0.1); }
        .filter-hiphop-blue { filter: contrast(1.3) hue-rotate(180deg) saturate(1.4) brightness(0.9); }
        .filter-vsco-bright { filter: contrast(1.15) saturate(1.5) brightness(1.1); }

        .magic-auto { filter: brightness(1.1) contrast(1.15) saturate(1.25) !important; }

        #bokeh-overlay {
            position: absolute; inset: 0; pointer-events: none; opacity: 0;
            background: radial-gradient(circle, transparent 30%, rgba(0,0,0,0.4) 100%);
            backdrop-filter: blur(0px); transition: all 0.5s; z-index: 4;
        }
        .bokeh-active { opacity: 1 !important; backdrop-filter: blur(4px) !important; }

        /* Nama Filter muncul saat di swipe */
        #filter-name-display {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-size: 24px; font-weight: 900; text-transform: uppercase; letter-spacing: 4px;
            color: white; text-shadow: 0 0 20px rgba(0,0,0,0.8);
            opacity: 0; pointer-events: none; z-index: 50; transition: opacity 0.3s;
        }

        /* UI Styles */
        .shutter-btn { display: flex; flex-direction: column; align-items: center; transition: all 0.2s; }
        .shutter-photo {
            width: 72px; height: 72px; background: #fff; border-radius: 50%;
            border: 4px solid rgba(255, 255, 255, 0.2); position: relative;
        }
        .shutter-photo::after { content: ''; position: absolute; inset: 4px; border-radius: 50%; border: 2px solid #000; }

        .ui-tray {
            position: absolute; left: 0; width: 100%; z-index: 25;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            background: linear-gradient(to top, rgba(0,0,0,0.9), rgba(0,0,0,0));
            pointer-events: auto;
        }
        .filter-tray { bottom: 240px; display: flex; gap: 14px; overflow-x: auto; padding: 12px 24px; }
        .zoom-overlay { bottom: 140px; display: flex; flex-direction: column; align-items: center; gap: 12px; padding-bottom: 20px; }
        .hidden-tray { transform: translateY(220px); opacity: 0; pointer-events: none; }

        .active-btn { background-color: #ffcc00 !important; color: black !important; border-color: transparent !important; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        #date-stamp {
            position: absolute; bottom: 20px; right: 20px; color: #ff8c00;
            font-family: "Courier New", Courier, monospace; font-weight: bold;
            font-size: 14px; text-shadow: 1px 1px 2px black; display: none;
        }

        .magic-active-pulse { animation: magic-glow 2s infinite; }
        @keyframes magic-glow {
            0% { box-shadow: 0 0 0 0 rgba(255, 204, 0, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(255, 204, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 204, 0, 0); }
        }
    </style>
</head>
<body>

    <div id="flash-overlay" class="fixed inset-0 bg-white opacity-0 pointer-events-none z-[100] transition-opacity duration-100"></div>
    <div id="save-toast" class="fixed top-8 left-1/2 -translate-x-1/2 -translate-y-20 bg-white text-black px-6 py-3 rounded-full font-bold z-[200] transition-transform duration-500 shadow-2xl">Capture Disimpan</div>

    <!-- MAIN CAMERA INTERFACE -->
    <div class="camera-preview" id="preview-container">
        <video id="video" autoplay playsinline muted></video>
        <div id="bokeh-overlay"></div>
        <div id="filter-name-display">Original</div>
        
        <!-- Grid Lines -->
        <div id="grid-lines" class="grid-overlay">
            <div class="grid-line-h" style="top: 33.33%;"></div>
            <div class="grid-line-h" style="top: 66.66%;"></div>
            <div class="grid-line-v" style="left: 33.33%;"></div>
            <div class="grid-line-v" style="left: 66.66%;"></div>
        </div>

        <div id="date-stamp">01 JAN 2026</div>
        
        <!-- Top Toolbar -->
        <div class="absolute top-0 left-0 w-full p-6 flex justify-between items-start z-10">
            <div class="flex flex-col gap-2">
                <div id="recording-indicator" class="hidden flex items-center bg-red-600 px-4 py-1.5 rounded-full text-[10px] font-black tracking-widest">
                    <span class="w-2 h-2 rounded-full mr-2 animate-pulse bg-white"></span>
                    <span id="rec-type" class="mr-2 uppercase">REC</span>
                    <span id="timer" class="font-mono">00:00</span>
                </div>
                <div class="flex flex-wrap gap-2 max-w-[200px]">
                    <button onclick="toggleGrid()" id="btn-grid" class="bg-black/40 px-3 py-2 rounded-lg backdrop-blur-md border border-white/10 text-[9px] font-bold">GRID</button>
                    <button onclick="toggleDateStamp()" id="btn-date" class="bg-black/40 px-3 py-2 rounded-lg backdrop-blur-md border border-white/10 text-[9px] font-bold">DATE</button>
                    <button onclick="toggleSlowMo()" id="btn-slomo" class="bg-black/40 px-3 py-2 rounded-lg backdrop-blur-md border border-white/10 text-[9px] font-bold">SLO-MO</button>
                    <button onclick="toggleMagicAuto()" id="btn-magic" class="bg-black/40 px-3 py-2 rounded-lg backdrop-blur-md border border-white/10 text-[9px] font-bold flex items-center gap-1">
                        <svg width="10" height="10" fill="currentColor" viewBox="0 0 24 24"><path d="M7.5 5.6L10 7L8.6 4.5L10 2L7.5 3.4L5 2L6.4 4.5L5 7L7.5 5.6M13.38 5.07L4.57 13.89C4.39 14.07 4.39 14.39 4.57 14.57L9.43 19.43C9.61 19.61 9.93 19.61 10.11 19.43L18.93 10.62C19.11 10.44 19.11 10.12 18.93 9.94L14.07 5.07M16.3 9.83L9.77 16.36L7.64 14.23L14.17 7.7L16.3 9.83Z"/></svg>
                        AUTO
                    </button>
                </div>
            </div>
            
            <div class="flex gap-2">
                <button id="toggle-zoom" onclick="toggleTray('zoom')" class="bg-black/40 p-3 rounded-full backdrop-blur-xl border border-white/10 active:scale-90 transition-all">
                    <svg width="20" height="20" fill="white" viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2v1z"/></svg>
                </button>
                <button id="toggle-filter" onclick="toggleTray('filter')" class="bg-black/40 p-3 rounded-full backdrop-blur-xl border border-white/10 active:scale-90 transition-all">
                    <svg width="20" height="20" fill="white" viewBox="0 0 24 24"><path d="M7.5 5.6L10 7L8.6 4.5L10 2L7.5 3.4L5 2L6.4 4.5L5 7L7.5 5.6M13.38 5.07L4.57 13.89C4.39 14.07 4.39 14.39 4.57 14.57L9.43 19.43C9.61 19.61 9.93 19.61 10.11 19.43L18.93 10.62C19.11 10.44 19.11 10.12 18.93 9.94L14.07 5.07M16.3 9.83L9.77 16.36L7.64 14.23L14.17 7.7L16.3 9.83Z"/></svg>
                </button>
                <button onclick="switchCamera()" class="bg-black/40 p-3 rounded-full backdrop-blur-xl border border-white/10">
                    <svg width="20" height="20" fill="white" viewBox="0 0 24 24"><path d="M19 8l-4 4h3c0 3.31-2.69 6-6 6-1.01 0-1.97-.25-2.8-.7l-1.46 1.46C8.97 19.54 10.43 20 12 20c4.42 0 8-3.58 8-8h3l-4-4zM6 12c0-3.31 2.69-6 6-6 1.01 0-1.97.25 2.8.7l1.46-1.46C15.03 4.46 13.57 4 12 4c-4.42 0-8 3.58-8 8H1l4 4 4-4H6z"/></svg>
                </button>
            </div>
        </div>

        <!-- Filter Tray -->
        <div id="filter-tray" class="ui-tray filter-tray no-scrollbar hidden-tray"></div>

        <!-- Zoom Tray -->
        <div id="zoom-tray" class="ui-tray zoom-overlay hidden-tray">
            <div class="flex gap-2">
                <button class="w-10 h-10 rounded-full bg-black/50 border border-white/20 text-[10px]" onclick="setZoom(0.5)">.5x</button>
                <button class="w-10 h-10 rounded-full bg-black/50 border border-white/20 text-[10px] active-btn" id="zoom-1x" onclick="setZoom(1)">1x</button>
                <button class="w-10 h-10 rounded-full bg-black/50 border border-white/20 text-[10px]" onclick="setZoom(3)">3x</button>
            </div>
            <input type="range" id="zoom-slider" min="0.5" max="10" step="0.1" value="1" class="w-2/3 accent-yellow-400" oninput="updateZoomFromSlider(this.value)">
        </div>
    </div>

    <!-- BOTTOM BAR -->
    <div class="fixed bottom-0 left-0 w-full bg-black p-4 pb-10">
        <div class="flex justify-between items-center max-w-md mx-auto px-6">
            <div id="gallery-preview" class="w-12 h-12 rounded-lg bg-white/10 bg-cover bg-center border border-white/20 shadow-lg" onclick="openEditor()"></div>
            
            <div class="shutter-btn">
                <button onclick="capturePhoto()" class="shutter-photo active:scale-90 transition-transform shadow-2xl"></button>
            </div>

            <button onclick="toggleRecording()" id="video-trigger" class="w-12 h-12 flex items-center justify-center rounded-full bg-white/5 border border-white/10 active:bg-red-500 transition-colors">
                <div class="w-4 h-4 rounded-full bg-red-600 shadow-sm" id="v-icon"></div>
            </button>
        </div>
    </div>

    <!-- EDITOR OVERLAY -->
    <div id="editor-overlay" class="fixed inset-0 bg-black z-50 hidden flex-col">
        <div class="p-6 flex justify-between items-center border-b border-white/10">
            <button onclick="closeEditor()" class="text-sm font-bold opacity-60">Batal</button>
            <h2 class="text-xs font-black tracking-widest uppercase text-yellow-400">Editor Ultra</h2>
            <button onclick="saveEditedImage()" class="text-sm font-bold text-yellow-400">Simpan</button>
        </div>
        <div class="flex-1 flex items-center justify-center bg-zinc-950 p-4">
            <canvas id="editor-canvas" class="max-w-full max-h-full"></canvas>
        </div>
        <div class="p-6 bg-black flex gap-4 overflow-x-auto no-scrollbar border-t border-white/10">
            <div class="flex flex-col items-center gap-1 min-w-[100px]">
                <span class="text-[8px] opacity-50 font-bold uppercase">Brightness</span>
                <input type="range" id="adj-bright" min="50" max="150" value="100" oninput="applyEditorFilters()" class="w-full accent-yellow-400">
            </div>
            <div class="flex flex-col items-center gap-1 min-w-[100px]">
                <span class="text-[8px] opacity-50 font-bold uppercase">Contrast</span>
                <input type="range" id="adj-contrast" min="50" max="150" value="100" oninput="applyEditorFilters()" class="w-full accent-yellow-400">
            </div>
            <div class="flex flex-col items-center gap-1 min-w-[100px]">
                <span class="text-[8px] opacity-50 font-bold uppercase">Saturation</span>
                <input type="range" id="adj-saturate" min="50" max="150" value="100" oninput="applyEditorFilters()" class="w-full accent-yellow-400">
            </div>
        </div>
    </div>

    <script>
        const video = document.getElementById('video');
        const filterTray = document.getElementById('filter-tray');
        const zoomTray = document.getElementById('zoom-tray');
        const zoomSlider = document.getElementById('zoom-slider');
        const gridLines = document.getElementById('grid-lines');
        const dateStampEl = document.getElementById('date-stamp');
        const galleryPreview = document.getElementById('gallery-preview');
        const editorOverlay = document.getElementById('editor-overlay');
        const editorCanvas = document.getElementById('editor-canvas');
        const bokehOverlay = document.getElementById('bokeh-overlay');
        const filterNameDisplay = document.getElementById('filter-name-display');
        const previewContainer = document.getElementById('preview-container');
        const ctx = editorCanvas.getContext('2d');

        let isFrontCamera = false;
        let activeFilterIndex = 0;
        let activeFilter = 'none';
        let currentZoom = 1;
        let showGrid = false;
        let showDate = false;
        let isSlowMo = false;
        let isMagicAuto = false;
        let lastCapturedImage = null;
        let trays = { filter: false, zoom: false };
        let isRecording = false;

        const FILTERS = [
            { id: 'none', name: 'Original', cat: 'Basic' },
            { id: 'bw', name: 'Black&White', cat: 'Classic' },
            { id: 'noir', name: 'Noir Drama', cat: 'Classic' },
            { id: 'cpm35', name: 'CPM35', cat: 'DazzCam' },
            { id: 'classic', name: 'Classic film', cat: 'DazzCam' },
            { id: 'vhs', name: 'Retro VHS', cat: 'Vintage' },
            { id: 'pastel', name: 'Soft Pastel', cat: 'Modern' },
            { id: 'brown', name: 'Aesthetic Brown', cat: 'Modern' },
            { id: 'minimalist', name: 'Minimalist', cat: 'Modern' },
            { id: 'bokeh', name: 'Bokeh Blur', cat: 'Creative' },
            { id: 'painting', name: 'Lukisan', cat: 'Creative' },
            { id: 'lightlens', name: 'Light Lens', cat: 'Creative' },
            { id: 'hiphop-blue', name: 'TikTok Blue', cat: 'Viral' },
            { id: 'vsco-bright', name: 'VSCO Bright', cat: 'Viral' }
        ];

        // --- SWIPE GESTURE LOGIC ---
        let touchStartX = 0;
        let touchEndX = 0;

        previewContainer.addEventListener('touchstart', e => {
            touchStartX = e.changedTouches[0].screenX;
        }, false);

        previewContainer.addEventListener('touchend', e => {
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
        }, false);

        function handleSwipe() {
            const threshold = 50;
            if (touchEndX < touchStartX - threshold) {
                // Swipe Left -> Next Filter
                activeFilterIndex = (activeFilterIndex + 1) % FILTERS.length;
                applyFilterFromIndex();
            }
            if (touchEndX > touchStartX + threshold) {
                // Swipe Right -> Prev Filter
                activeFilterIndex = (activeFilterIndex - 1 + FILTERS.length) % FILTERS.length;
                applyFilterFromIndex();
            }
        }

        function applyFilterFromIndex() {
            const filter = FILTERS[activeFilterIndex];
            activeFilter = filter.id;
            updateCameraFilters();
            showFilterName(filter.name);
            
            // Update UI tray if open
            const allFilterBoxes = document.querySelectorAll('.filter-item-box');
            if(allFilterBoxes.length > 0) {
                allFilterBoxes.forEach(el => el.style.borderColor = 'rgba(255,255,255,0.1)');
                allFilterBoxes[activeFilterIndex].style.borderColor = '#ffcc00';
                allFilterBoxes[activeFilterIndex].scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
            }
        }

        function showFilterName(name) {
            filterNameDisplay.innerText = name;
            filterNameDisplay.style.opacity = '1';
            setTimeout(() => {
                filterNameDisplay.style.opacity = '0';
            }, 800);
        }

        async function initCamera() {
            if (window.stream) window.stream.getTracks().forEach(t => t.stop());
            try {
                const s = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: isFrontCamera ? 'user' : 'environment', width: { ideal: 1920 } },
                    audio: true
                });
                window.stream = s;
                video.srcObject = s;
            } catch (e) { console.error(e); }
        }

        function toggleTray(type) {
            Object.keys(trays).forEach(k => {
                if(k !== type) {
                    trays[k] = false;
                    document.getElementById(`${k}-tray`).classList.add('hidden-tray');
                    document.getElementById(`toggle-${k}`).classList.remove('active-btn');
                }
            });
            trays[type] = !trays[type];
            const t = document.getElementById(`${type}-tray`);
            const b = document.getElementById(`toggle-${type}`);
            t.classList.toggle('hidden-tray', !trays[type]);
            b.classList.toggle('active-btn', trays[type]);
        }

        function toggleGrid() {
            showGrid = !showGrid;
            gridLines.classList.toggle('active', showGrid);
            document.getElementById('btn-grid').classList.toggle('active-btn', showGrid);
        }

        function toggleDateStamp() {
            showDate = !showDate;
            dateStampEl.style.display = showDate ? 'block' : 'none';
            document.getElementById('btn-date').classList.toggle('active-btn', showDate);
            if (showDate) {
                const now = new Date();
                const months = ['JAN', 'FEB', 'MAR', 'APR', 'MEI', 'JUN', 'JUL', 'AGU', 'SEP', 'OKT', 'NOV', 'DES'];
                dateStampEl.innerText = `${now.getDate()} ${months[now.getMonth()]} ${now.getFullYear()}`;
            }
        }

        function toggleSlowMo() {
            isSlowMo = !isSlowMo;
            video.playbackRate = isSlowMo ? 0.5 : 1.0;
            document.getElementById('btn-slomo').classList.toggle('active-btn', isSlowMo);
        }

        function toggleMagicAuto() {
            isMagicAuto = !isMagicAuto;
            const btn = document.getElementById('btn-magic');
            btn.classList.toggle('active-btn', isMagicAuto);
            btn.classList.toggle('magic-active-pulse', isMagicAuto);
            updateCameraFilters();
        }

        function updateCameraFilters() {
            let filterClass = `filter-${activeFilter}`;
            video.className = isMagicAuto ? `${filterClass} magic-auto` : filterClass;
            
            if(activeFilter === 'bokeh') {
                bokehOverlay.classList.add('bokeh-active');
            } else {
                bokehOverlay.classList.remove('bokeh-active');
            }
        }

        function setZoom(v) { 
            currentZoom = v; 
            zoomSlider.value = v; 
            applyZoom(); 
            document.querySelectorAll('.zoom-overlay button').forEach(btn => btn.classList.remove('active-btn'));
            if(v === 1) document.getElementById('zoom-1x').classList.add('active-btn');
        }

        function updateZoomFromSlider(v) { currentZoom = parseFloat(v); applyZoom(); }
        function applyZoom() { video.style.transform = `scale(${currentZoom})`; }

        function capturePhoto() {
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            const c = canvas.getContext('2d');
            c.filter = getComputedStyle(video).filter;
            
            const sw = canvas.width / currentZoom;
            const sh = canvas.height / currentZoom;
            const sx = (canvas.width - sw) / 2;
            const sy = (canvas.height - sh) / 2;
            c.drawImage(video, sx, sy, sw, sh, 0, 0, canvas.width, canvas.height);

            if(activeFilter === 'bokeh') {
                c.filter = 'blur(10px)';
                c.globalAlpha = 0.4;
                c.drawImage(canvas, 0, 0);
                c.globalAlpha = 1.0;
            }

            if(showDate) {
                c.fillStyle = '#ff8c00';
                c.font = 'bold 60px Courier New';
                c.textAlign = 'right';
                c.fillText(dateStampEl.innerText, canvas.width - 50, canvas.height - 100);
            }

            lastCapturedImage = canvas.toDataURL('image/jpeg', 0.9);
            galleryPreview.style.backgroundImage = `url(${lastCapturedImage})`;
            
            const f = document.getElementById('flash-overlay');
            f.style.opacity = '1'; setTimeout(() => f.style.opacity = '0', 100);
            
            const t = document.getElementById('save-toast');
            t.classList.add('translate-y-24'); setTimeout(() => t.classList.remove('translate-y-24'), 2000);
        }

        function toggleRecording() {
            isRecording = !isRecording;
            const indicator = document.getElementById('recording-indicator');
            const vIcon = document.getElementById('v-icon');
            if (isRecording) {
                indicator.classList.remove('hidden');
                vIcon.classList.replace('rounded-full', 'rounded-sm');
            } else {
                indicator.classList.add('hidden');
                vIcon.classList.replace('rounded-sm', 'rounded-full');
            }
        }

        function initFilterTray() {
            filterTray.innerHTML = '';
            FILTERS.forEach((f, index) => {
                const div = document.createElement('div');
                div.className = `flex flex-col items-center flex-shrink-0 w-20 cursor-pointer`;
                div.onclick = () => {
                    activeFilterIndex = index;
                    applyFilterFromIndex();
                };
                div.innerHTML = `
                    <div class="filter-item-box w-14 h-14 rounded-2xl border-2 ${index === activeFilterIndex ? 'border-yellow-400' : 'border-white/10'} overflow-hidden mb-1 filter-${f.id} bg-zinc-800 flex items-center justify-center text-[10px] font-black">
                        ${f.id === 'none' ? 'ORI' : 'FX'}
                    </div>
                    <span class="text-[7px] font-bold uppercase opacity-80 text-center">${f.name}</span>
                    <span class="text-[5px] font-bold uppercase opacity-40">${f.cat}</span>
                `;
                filterTray.appendChild(div);
            });
        }

        function openEditor() {
            if(!lastCapturedImage) return;
            editorOverlay.classList.remove('hidden');
            const img = new Image();
            img.onload = () => {
                editorCanvas.width = img.width;
                editorCanvas.height = img.height;
                ctx.drawImage(img, 0, 0);
                editorCanvas.original = img;
            };
            img.src = lastCapturedImage;
        }

        function applyEditorFilters() {
            const b = document.getElementById('adj-bright').value;
            const c = document.getElementById('adj-contrast').value;
            const s = document.getElementById('adj-saturate').value;
            ctx.filter = `brightness(${b}%) contrast(${c}%) saturate(${s}%)`;
            ctx.drawImage(editorCanvas.original, 0, 0);
        }

        function saveEditedImage() {
            const link = document.createElement('a');
            link.download = `ProCam_Edit_${Date.now()}.jpg`;
            link.href = editorCanvas.toDataURL('image/jpeg', 0.9);
            link.click();
            closeEditor();
        }

        function closeEditor() { editorOverlay.classList.add('hidden'); }
        function switchCamera() { isFrontCamera = !isFrontCamera; initCamera(); }

        window.onload = () => { initCamera(); initFilterTray(); };
    </script>
</body>
</html>
