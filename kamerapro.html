<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ProCam Ultra - Cinema Suite v11</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-color: #000;
            color: #fff;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            overflow: hidden;
            height: 100vh;
            user-select: none;
        }

        .camera-preview {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            background: #000;
        }

        #video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease-out;
            transform-origin: center center;
        }

        /* --- EXTENDED FILTER LIBRARY --- */
        .filter-none { filter: none; }
        .filter-bw { filter: grayscale(1) contrast(1.2); }
        .filter-noir { filter: grayscale(1) contrast(1.8) brightness(0.7); }
        
        /* VSCO Inspired */
        .filter-m5 { filter: sepia(0.3) contrast(1.1) brightness(0.9) saturate(0.8); }
        .filter-c1 { filter: saturate(1.6) contrast(1.1) brightness(1.1); }
        .filter-f2 { filter: sepia(0.2) contrast(0.9) brightness(1.1) saturate(0.7) blur(0.2px); }
        .filter-g3 { filter: contrast(1.05) saturate(1.2) brightness(1.05) hue-rotate(-5deg); }
        
        /* Cinematic & Tone Populer (NEW) */
        .filter-teal-orange { filter: contrast(1.25) saturate(1.4) hue-rotate(-15deg) brightness(0.95); }
        .filter-warm-nostalgia { filter: sepia(0.5) saturate(1.4) brightness(1.05) contrast(1.1); }
        .filter-cool-desat { filter: hue-rotate(190deg) saturate(0.5) contrast(1.1) brightness(1.1); }
        .filter-dark-moody { filter: brightness(0.6) contrast(1.6) saturate(0.8) sepia(0.1); }
        .filter-desaturated { filter: saturate(0.4) contrast(1.2) brightness(1.1); }
        
        /* Visual Texture & Effects (NEW) */
        .filter-diffusion { filter: blur(0.8px) brightness(1.1) contrast(0.9) saturate(1.1); }
        .filter-grainy { filter: contrast(1.2) brightness(1.1) grayscale(0.2) url(#noise); }
        .filter-light-leak { filter: sepia(0.3) saturate(1.5) brightness(1.1) hue-rotate(340deg); }
        .filter-dreamy { filter: opacity(0.9) contrast(0.8) brightness(1.2) blur(1.5px) saturate(1.3); }

        /* Analog & DazzCam */
        .filter-vhs { filter: contrast(0.9) saturate(1.3) hue-rotate(10deg) sepia(0.2); }
        .filter-cpm35 { filter: sepia(0.4) saturate(1.5) contrast(1.1) brightness(0.9); }
        
        /* Aesthetic Trends */
        .filter-pastel { filter: brightness(1.2) saturate(0.8) contrast(0.8) sepia(0.1); }
        .filter-brown { filter: sepia(0.6) contrast(1.1) brightness(0.95) saturate(0.9); }
        .filter-minimalist { filter: contrast(1.1) brightness(1.05) saturate(0.85); }
        
        /* TikTok Viral */
        .filter-blue-hiphop { filter: hue-rotate(180deg) saturate(1.5) contrast(1.2) brightness(0.9); }

        .magic-auto-active { filter: brightness(1.15) contrast(1.1) saturate(1.2) !important; }

        .ui-tray {
            position: absolute; left: 0; width: 100%; z-index: 50;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .filter-tray { 
            top: 75px; 
            display: flex; 
            gap: 12px; 
            overflow-x: auto; 
            padding: 15px 20px; 
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(15px);
            scrollbar-width: none;
        }
        .filter-tray::-webkit-scrollbar { display: none; }

        .zoom-overlay, .speed-overlay { 
            bottom: 130px; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            padding-bottom: 20px; 
        }
        
        .hidden-tray { transform: translateY(-20px); opacity: 0; pointer-events: none; }
        .speed-overlay.hidden-tray, .zoom-overlay.hidden-tray { transform: translateY(20px); }

        .active-btn { background-color: #ffcc00 !important; color: black !important; border-color: #ffcc00 !important; }
        
        .filter-card {
            flex: 0 0 auto;
            width: 85px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            cursor: pointer;
        }
        .filter-thumb {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            border: 2px solid rgba(255,255,255,0.3);
            background: #222;
            transition: all 0.2s;
            background-size: cover;
            background-position: center;
        }
        .filter-card.active .filter-thumb {
            border-color: #ffcc00;
            transform: scale(1.1);
        }
        .filter-name {
            font-size: 8px;
            font-weight: 700;
            text-transform: uppercase;
            color: rgba(255,255,255,0.6);
            text-align: center;
            white-space: nowrap;
        }
        .filter-card.active .filter-name { color: #ffcc00; }

        .shutter-photo {
            width: 70px; height: 70px; background: #fff; border-radius: 50%;
            border: 5px solid rgba(255, 255, 255, 0.3); transition: transform 0.1s;
        }
        .shutter-photo:active { transform: scale(0.9); }

        #recording-dot {
            width: 18px; height: 18px; background: #ff0000; border-radius: 50%;
            transition: all 0.3s;
        }
        .recording-active #recording-dot { border-radius: 4px; transform: scale(0.8); }

        #save-toast {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%) translateY(-100px);
            background: #fff; color: #000; padding: 10px 25px; border-radius: 50px;
            font-weight: bold; z-index: 1000; transition: transform 0.5s;
        }
        #save-toast.show { transform: translateX(-50%) translateY(0); }
    </style>
</head>
<body>

    <!-- SVG Filter for Film Grain -->
    <svg style="display:none;">
        <filter id="noise">
            <feTurbulence type="fractalNoise" baseFrequency="0.65" numOctaves="3" stitchTiles="stitch" />
            <feComponentTransfer>
                <feFuncR type="linear" slope="0.1" />
                <feFuncG type="linear" slope="0.1" />
                <feFuncB type="linear" slope="0.1" />
            </feComponentTransfer>
            <feComposite operator="in" in2="SourceGraphic" />
            <feBlend mode="overlay" in2="SourceGraphic" />
        </filter>
    </svg>

    <div id="save-toast">Pesan Disimpan</div>
    <div id="flash-overlay" class="fixed inset-0 bg-white opacity-0 pointer-events-none z-[100] transition-opacity duration-100"></div>

    <div class="camera-preview">
        <video id="video" autoplay playsinline muted></video>
        
        <!-- Header Controls -->
        <div class="absolute top-0 left-0 w-full p-4 flex justify-between items-center z-[60] bg-gradient-to-b from-black/80 to-transparent">
            <div class="flex items-center gap-2">
                <div id="recording-indicator" class="hidden flex items-center bg-red-600/90 px-3 py-1 rounded-full text-[10px] font-bold">
                    <span class="w-2 h-2 rounded-full bg-white animate-ping mr-2"></span>
                    <span id="timer">00:00</span>
                </div>
                <button onclick="toggleMagicAuto()" id="btn-magic" class="bg-black/40 px-3 py-2 rounded-full border border-white/20 text-[9px] font-bold">MAGIC</button>
                <button onclick="toggleGrid()" id="btn-grid" class="bg-black/40 px-3 py-2 rounded-full border border-white/20 text-[9px] font-bold">GRID</button>
            </div>
            
            <div class="flex gap-2">
                <button onclick="toggleTray('filter')" id="btn-filter-toggle" class="bg-black/40 p-2.5 rounded-full border border-white/20 transition-colors">
                    <svg width="18" height="18" fill="white" viewBox="0 0 24 24"><path d="M14.73 20.83L17.58 18L14.73 15.17L15.85 14.03L20 18.17L15.85 22.31L14.73 20.83M10.5 12.78L12.75 15L8.5 19.25L4.25 15L6.5 12.78L10.5 12.78M10.5 3L15 7.5L10.5 12L6 7.5L10.5 3Z"/></svg>
                </button>
                <button onclick="toggleTray('speed')" class="bg-black/40 p-2.5 rounded-full border border-white/20 text-[10px] font-bold w-[42px]" id="btn-speed-toggle">1x</button>
                <button onclick="toggleTray('zoom')" class="bg-black/40 p-2.5 rounded-full border border-white/20">
                    <svg width="18" height="18" fill="white" viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
                </button>
                <button onclick="switchCamera()" class="bg-black/40 p-2.5 rounded-full border border-white/20">
                    <svg width="18" height="18" fill="white" viewBox="0 0 24 24"><path d="M19 8l-4 4h3c0 3.31-2.69 6-6 6-1.01 0-1.97-.25-2.8-.7l-1.46 1.46C8.97 19.54 10.43 20 12 20c4.42 0 8-3.58 8-8h3l-4-4zM6 12c0-3.31 2.69-6 6-6 1.01 0-1.97.25 2.8.7l1.46-1.46C15.03 4.46 13.57 4 12 4c-4.42 0-8 3.58-8 8H1l4 4 4-4H6z"/></svg>
                </button>
            </div>
        </div>

        <!-- Filter Tray -->
        <div id="filter-tray" class="ui-tray filter-tray hidden-tray"></div>

        <!-- Zoom Tray -->
        <div id="zoom-tray" class="ui-tray zoom-overlay hidden-tray">
            <input type="range" id="zoom-slider" min="1" max="5" step="0.1" value="1" class="w-2/3 accent-yellow-400" oninput="updateZoom(this.value)">
            <span class="text-xs font-bold text-yellow-400 mt-2" id="zoom-text">1.0x</span>
        </div>

        <!-- Speed Tray -->
        <div id="speed-tray" class="ui-tray speed-overlay hidden-tray">
            <div class="flex gap-4">
                <button onclick="setVideoSpeed(0.5)" id="speed-05" class="px-5 py-2 rounded-full bg-white/10 border border-white/20 text-[10px]">0.5x SLOW</button>
                <button onclick="setVideoSpeed(1)" id="speed-1" class="px-5 py-2 rounded-full bg-white/10 border border-white/20 text-[10px] active-btn">1x NORMAL</button>
            </div>
        </div>

        <!-- Grid Lines -->
        <div id="grid-lines" class="absolute inset-0 pointer-events-none hidden">
            <div class="absolute w-full h-[1px] bg-white/30 top-1/3"></div>
            <div class="absolute w-full h-[1px] bg-white/30 top-2/3"></div>
            <div class="absolute h-full w-[1px] bg-white/30 left-1/3"></div>
            <div class="absolute h-full w-[1px] bg-white/30 left-2/3"></div>
        </div>

        <!-- Bottom Controls -->
        <div class="absolute bottom-0 left-0 w-full p-8 pb-12 flex justify-between items-center bg-gradient-to-t from-black to-transparent">
            <!-- Galeri Pratinjau -->
            <div id="gallery-preview" class="w-12 h-12 rounded-lg border-2 border-white/40 bg-cover bg-center overflow-hidden cursor-pointer z-[70] shadow-lg active:scale-95 transition-transform" onclick="openEditor()">
                <div class="w-full h-full bg-white/10 flex items-center justify-center">
                    <svg width="20" height="20" fill="white" opacity="0.8" viewBox="0 0 24 24"><path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/></svg>
                </div>
            </div>
            
            <button onclick="capturePhoto()" class="shutter-photo"></button>
            
            <button onclick="toggleRecording()" id="video-trigger" class="w-14 h-14 rounded-full border-2 border-white/40 flex items-center justify-center">
                <div id="recording-dot"></div>
            </button>
        </div>
    </div>

    <!-- Editor Overlay -->
    <div id="editor-overlay" class="fixed inset-0 bg-black z-[200] hidden flex flex-col">
        <div class="p-4 flex justify-between items-center border-b border-white/10">
            <button onclick="closeEditor()" class="text-sm font-bold opacity-50 uppercase tracking-widest px-2 py-1">Tutup</button>
            <button id="save-btn" onclick="saveEditedPhoto()" class="text-sm font-bold text-yellow-400 uppercase tracking-widest px-2 py-1 bg-yellow-400/10 rounded">Simpan</button>
        </div>
        <div class="flex-1 flex items-center justify-center p-4 bg-zinc-900 overflow-hidden relative">
            <div id="editor-loading" class="hidden absolute inset-0 flex items-center justify-center bg-black/50 z-10">
                <span class="text-white text-xs font-bold animate-pulse">MEMUAT GAMBAR...</span>
            </div>
            <canvas id="editor-canvas" class="max-w-full max-h-full shadow-2xl bg-black"></canvas>
        </div>
    </div>

    <script>
        const video = document.getElementById('video');
        const gridLines = document.getElementById('grid-lines');
        const galleryPreview = document.getElementById('gallery-preview');
        const editorCanvas = document.getElementById('editor-canvas');
        const ctx = editorCanvas.getContext('2d');
        
        let isFrontCamera = false;
        let activeFilter = 'none';
        let currentZoom = 1;
        let isMagicAuto = false;
        let showGrid = false;
        let lastCapturedImage = null;
        let isRecording = false;
        let currentSpeed = 1;
        let recordStartTime = 0;
        let timerInterval = null;
        
        let mediaRecorder;
        let recordedChunks = [];

        // --- UPDATED EXTENDED FILTERS LIST ---
        const FILTERS = [
            { id: 'none', name: 'Asli' },
            { id: 'teal-orange', name: 'Teal Orange' },
            { id: 'warm-nostalgia', name: 'Nostalgia' },
            { id: 'dark-moody', name: 'Dark Moody' },
            { id: 'cool-desat', name: 'Cool Tone' },
            { id: 'diffusion', name: 'Mist Filter' },
            { id: 'dreamy', name: 'Dreamy' },
            { id: 'grainy', name: 'Film Grain' },
            { id: 'bw', name: 'B&W Drama' },
            { id: 'm5', name: 'VSCO M5' },
            { id: 'c1', name: 'VSCO C1' },
            { id: 'f2', name: 'VSCO F2' },
            { id: 'g3', name: 'VSCO G3' },
            { id: 'vhs', name: 'Retro VHS' },
            { id: 'cpm35', name: 'Dazz CPM35' },
            { id: 'pastel', name: 'Soft Pastel' },
            { id: 'brown', name: 'Warm Brown' },
            { id: 'minimalist', name: 'Minimal' },
            { id: 'blue-hiphop', name: 'Blue HipHop' }
        ];

        async function initCamera() {
            if (window.stream) window.stream.getTracks().forEach(t => t.stop());
            const constraints = {
                video: { facingMode: isFrontCamera ? 'user' : 'environment', width: { ideal: 1920 }, height: { ideal: 1080 } },
                audio: true
            };
            try {
                const stream = await navigator.mediaDevices.getUserMedia(constraints);
                window.stream = stream;
                video.srcObject = stream;
            } catch (e) { showToast("Gagal akses kamera"); }
        }

        function toggleMagicAuto() {
            isMagicAuto = !isMagicAuto;
            document.getElementById('btn-magic').classList.toggle('active-btn', isMagicAuto);
            updateFilters();
        }

        function toggleGrid() {
            showGrid = !showGrid;
            gridLines.classList.toggle('hidden', !showGrid);
            document.getElementById('btn-grid').classList.toggle('active-btn', showGrid);
        }

        function setVideoSpeed(speed) {
            currentSpeed = speed;
            video.playbackRate = speed;
            document.getElementById('btn-speed-toggle').innerText = speed + 'x';
            document.querySelectorAll('[id^="speed-"]').forEach(b => b.classList.remove('active-btn'));
            document.getElementById('speed-' + (speed === 0.5 ? '05' : '1')).classList.add('active-btn');
            toggleTray('speed');
        }

        function updateZoom(val) {
            currentZoom = val;
            video.style.transform = `scale(${val})`;
            document.getElementById('zoom-text').innerText = parseFloat(val).toFixed(1) + 'x';
        }

        function setFilter(id) {
            activeFilter = id;
            updateFilters();
            document.querySelectorAll('.filter-card').forEach(card => {
                card.classList.toggle('active', card.dataset.id === id);
            });
            document.getElementById('btn-filter-toggle').classList.toggle('active-btn', id !== 'none');
        }

        function updateFilters() {
            video.className = `filter-${activeFilter} ${isMagicAuto ? 'magic-auto-active' : ''}`;
        }

        function toggleTray(type) {
            const trays = ['filter', 'zoom', 'speed'];
            trays.forEach(t => {
                const el = document.getElementById(`${t}-tray`);
                if(t === type) el.classList.toggle('hidden-tray');
                else el.classList.add('hidden-tray');
            });
        }

        function renderFilters() {
            const tray = document.getElementById('filter-tray');
            tray.innerHTML = '';
            FILTERS.forEach(f => {
                const card = document.createElement('div');
                card.className = `filter-card ${f.id === activeFilter ? 'active' : ''}`;
                card.dataset.id = f.id;
                card.onclick = () => setFilter(f.id);
                
                const thumb = document.createElement('div');
                thumb.className = `filter-thumb filter-${f.id}`;
                thumb.style.backgroundImage = "linear-gradient(45deg, #333, #555)";
                
                const name = document.createElement('span');
                name.className = "filter-name";
                name.innerText = f.name;
                
                card.appendChild(thumb);
                card.appendChild(name);
                tray.appendChild(card);
            });
        }

        function capturePhoto() {
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            const c = canvas.getContext('2d');
            
            // Apply CSS filters to canvas
            c.filter = getComputedStyle(video).filter;
            
            const sw = video.videoWidth / currentZoom;
            const sh = video.videoHeight / currentZoom;
            const sx = (video.videoWidth - sw) / 2;
            const sy = (video.videoHeight - sh) / 2;
            c.drawImage(video, sx, sy, sw, sh, 0, 0, canvas.width, canvas.height);
            
            lastCapturedImage = canvas.toDataURL('image/jpeg', 0.95);
            galleryPreview.style.backgroundImage = `url(${lastCapturedImage})`;
            
            document.getElementById('flash-overlay').style.opacity = '1';
            setTimeout(() => document.getElementById('flash-overlay').style.opacity = '0', 100);
            showToast("Foto Berhasil Diambil");
        }

        function toggleRecording() {
            if (!isRecording) startRecording();
            else stopRecording();
        }

        function startRecording() {
            recordedChunks = [];
            const types = [
                'video/mp4;codecs=h264',
                'video/webm;codecs=h264',
                'video/webm;codecs=vp9',
                'video/webm'
            ];
            
            let selectedType = types.find(t => MediaRecorder.isTypeSupported(t)) || 'video/webm';
            
            try {
                mediaRecorder = new MediaRecorder(window.stream, { 
                    mimeType: selectedType,
                    videoBitsPerSecond: 2500000 
                });
                
                mediaRecorder.ondataavailable = (e) => {
                    if (e.data.size > 0) recordedChunks.push(e.data);
                };
                
                mediaRecorder.onstop = saveVideo;
                mediaRecorder.start();
                
                isRecording = true;
                document.getElementById('video-trigger').classList.add('recording-active');
                document.getElementById('recording-indicator').classList.remove('hidden');
                recordStartTime = Date.now();
                timerInterval = setInterval(updateTimer, 1000);
            } catch (e) {
                showToast("Perekaman Gagal");
            }
        }

        function stopRecording() {
            if(mediaRecorder && isRecording) {
                mediaRecorder.stop();
                isRecording = false;
                document.getElementById('video-trigger').classList.remove('recording-active');
                document.getElementById('recording-indicator').classList.add('hidden');
                clearInterval(timerInterval);
            }
        }

        function saveVideo() {
            const blob = new Blob(recordedChunks, { type: 'video/mp4' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.style.display = 'none';
            a.href = url;
            a.download = `ProCam_Video_${Date.now()}.mp4`;
            document.body.appendChild(a);
            a.click();
            setTimeout(() => {
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
            }, 100);
            showToast("Video MP4 Tersimpan");
        }

        function updateTimer() {
            const diff = Math.floor((Date.now() - recordStartTime) / 1000);
            const m = String(Math.floor(diff / 60)).padStart(2, '0');
            const s = String(diff % 60).padStart(2, '0');
            document.getElementById('timer').innerText = `${m}:${s}`;
        }

        function openEditor() {
            if(!lastCapturedImage) return showToast("Ambil foto terlebih dahulu");
            
            const overlay = document.getElementById('editor-overlay');
            const loader = document.getElementById('editor-loading');
            
            overlay.classList.remove('hidden');
            loader.classList.remove('hidden');
            
            const img = new Image();
            img.onload = () => {
                editorCanvas.width = img.width;
                editorCanvas.height = img.height;
                ctx.clearRect(0, 0, editorCanvas.width, editorCanvas.height);
                ctx.drawImage(img, 0, 0);
                loader.classList.add('hidden');
            };
            img.onerror = () => {
                showToast("Gagal memuat pratinjau");
                overlay.classList.add('hidden');
            };
            img.src = lastCapturedImage;
        }

        function closeEditor() { 
            document.getElementById('editor-overlay').classList.add('hidden'); 
        }
        
        function saveEditedPhoto() {
            try {
                const dataURL = editorCanvas.toDataURL('image/jpeg', 0.95);
                const a = document.createElement('a');
                a.style.display = 'none';
                a.href = dataURL;
                a.download = `ProCam_Edit_${Date.now()}.jpg`;
                document.body.appendChild(a);
                a.click();
                setTimeout(() => { document.body.removeChild(a); }, 100);
                showToast("Hasil Edit Disimpan");
                closeEditor();
            } catch (e) {
                console.error(e);
                showToast("Gagal Simpan Edit");
            }
        }
        
        function showToast(msg) {
            const toast = document.getElementById('save-toast');
            toast.innerText = msg;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2000);
        }
        
        function switchCamera() { isFrontCamera = !isFrontCamera; initCamera(); }

        window.onload = () => {
            initCamera();
            renderFilters();
        };
    </script>
</body>
</html>
